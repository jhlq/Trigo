<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Trigo! Board {{.Key}}</title>
{{.Header}}
</head>
<body>
	<h1>Trigo!</h1>
	<h2>Board {{.Key}}</h2>
		
	{{.Board}}
	
	{{.Footer}}

<script type="text/javascript" src="/javascript/trigolib.js"></script>
<script type="text/javascript" src="/javascript/screenboard.js"></script>

<script>
var sb=new Trigo.ScreenBoard("TriCanvas",9);
sb.drawGrid();
sb.setupWS("boards/{{.Key}}");
var ai=new Trigo.AI(sb.board);
sb.ai=ai;

document.body.addEventListener("keydown", keyDown, false);
function keyDown(e) {
	if (document.getElementById("shortcuts")==null || typeof(document.getElementById("shortcuts"))=="undefined"){
		document.removeEventListener("keydown", keyDown);
	} else if (document.getElementById("shortcuts").checked){
		
		var k = e.keyCode; //enter is 13
		//alert(k)
		if(k==83) { //s
			document.getElementById("y").value=parseInt(document.getElementById("y").value)+1;
			document.getElementById("x").value=parseInt(document.getElementById("x").value)-1;
		} else if (k==65){ //a
			document.getElementById("x").value=parseInt(document.getElementById("x").value)-1;
		} else if (k==80){ //p
			sb.plotInfluence();
			return;
		} else if (k==68){ //d
			document.getElementById("x").value=parseInt(document.getElementById("x").value)+1;
		} else if (k==69){ //e,	|| k==13 conflicts with enter for buttons
			var docx=parseInt(document.getElementById("x").value);
			var docy=parseInt(document.getElementById("y").value);
			//sb.placeMove(docx,docy);
			sb.handleClick(docx,docy);
		} else if (k==87){ //w
			document.getElementById("y").value=parseInt(document.getElementById("y").value)-1;
			document.getElementById("x").value=parseInt(document.getElementById("x").value)+1;
		} else {
			return 0;
		}
		crosshair();
	}
}
function crosshair(){
	sb.placeMoves();
	var docx=parseInt(document.getElementById("x").value);
	var docy=parseInt(document.getElementById("y").value);
	if (sb.board.tg.has(docx,docy)){
		var st=sb.triangles[docy][docx];
		sb.drawer.line(st.pixX-sb.unitSize,st.pixY,st.pixX+sb.unitSize,st.pixY,"#909",5);
		sb.drawer.line(st.pixX,st.pixY-sb.unitSize,st.pixX,st.pixY+sb.unitSize,"#909",5);
	}
};

</script>
</body>
</html>
